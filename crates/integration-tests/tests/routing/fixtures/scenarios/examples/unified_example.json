{
  "name": "Unified E2E Example",
  "description": "Demonstrates all features: user input, agent response, tool calls, background tasks, and UI verification",
  "config": {
    "terminal_size": [80, 30],
    "enable_vector_cache": true,
    "mock_embedding_speed": 10
  },
  "initial_state": {
    "workspace_files": [
      {
        "path": "src/main.rs",
        "content": "fn main() {\n    println!(\"Hello\");\n}"
      },
      {
        "path": "src/lib.rs",
        "content": "pub fn test() {}"
      },
      {
        "path": "config.json",
        "content": "{\"name\": \"test-app\", \"version\": \"1.0.0\"}"
      }
    ],
    "existing_tasks": [],
    "vector_cache_state": "empty"
  },
  "steps": [
    {
      "step": 1,
      "action": {
        "type": "wait",
        "data": {
          "duration_ms": 50
        }
      },
      "expectations": {
        "background_tasks": {
          "embedding_cache": {
            "status": "running",
            "progress": 0,
            "total": 3
          }
        },
        "ui_state": {
          "snapshot": "unified_example_step1.txt"
        }
      }
    },
    {
      "step": 2,
      "action": {
        "type": "user_input",
        "data": {
          "text": "Read config.json and tell me what's in it",
          "submit": true
        }
      },
      "expectations": {
        "tasks": {
          "spawned": [
            {
              "description": "Read config.json and tell me what's in it",
              "status": "running"
            }
          ]
        },
        "ui_state": {
          "task_count": 1
        }
      }
    },
    {
      "step": 3,
      "action": {
        "type": "agent_response",
        "data": {
          "text": "I'll read the config.json file for you.",
          "tool_calls": [
            {
              "tool": "read_file",
              "args": {
                "path": "config.json"
              }
            }
          ],
          "subtasks": []
        }
      },
      "expectations": {
        "events": [
          {
            "type": "ToolCallStarted",
            "tool": "read_file"
          }
        ],
        "ui_state": {
          "snapshot": "unified_example_step3.txt"
        }
      }
    },
    {
      "step": 4,
      "action": {
        "type": "tool_result",
        "data": {
          "tool": "read_file",
          "success": true,
          "output": "{\"name\": \"test-app\", \"version\": \"1.0.0\"}"
        }
      },
      "expectations": {
        "events": [
          {
            "type": "ToolCallCompleted",
            "tool": "read_file",
            "success": true
          }
        ]
      }
    },
    {
      "step": 5,
      "action": {
        "type": "background_event",
        "data": {
          "event_type": "embedding_progress",
          "progress": 2,
          "total": 3
        }
      },
      "expectations": {
        "background_tasks": {
          "embedding_cache": {
            "status": "running",
            "progress": 2,
            "total": 3
          }
        },
        "ui_state": {
          "has_progress": true
        }
      }
    },
    {
      "step": 6,
      "action": {
        "type": "agent_response",
        "data": {
          "text": "The config.json file contains:\n- name: test-app\n- version: 1.0.0",
          "tool_calls": [],
          "subtasks": []
        }
      },
      "expectations": {
        "ui_state": {
          "snapshot": "unified_example_step6.txt"
        }
      }
    }
  ]
}
