{
  "name": "Conversation Context Accumulation",
  "description": "Tests multi-turn conversation where context accumulates and influences later responses",
  "tags": ["context", "conversation", "accumulation", "multi-turn"],
  "setup": {
    "files": {
      "user_data.json": "{\"name\": \"Alice\", \"role\": \"developer\"}"
    },
    "terminal_size": [120, 40]
  },
  "events": [
    {
      "type": "user_input",
      "data": {
        "text": "Read user_data.json and tell me the name",
        "submit": true
      }
    },
    {
      "type": "llm_response",
      "trigger": {
        "pattern": "tell me the name",
        "match_type": "contains"
      },
      "response": {
        "typescript": [
          "async function agent_code(): Promise<string> {",
          "  const data = await readFile('user_data.json');",
          "  const parsed = JSON.parse(data);",
          "  return `The name is ${parsed.name}`;",
          "}"
        ]
      },
      "verify": {
        "execution": {}
      }
    },
    {
      "type": "user_input",
      "data": {
        "text": "What role does that person have?",
        "submit": true
      }
    },
    {
      "type": "llm_response",
      "trigger": {
        "pattern": "What role",
        "match_type": "contains"
      },
      "response": {
        "typescript": [
          "async function agent_code(): Promise<string> {",
          "  const data = await readFile('user_data.json');",
          "  const parsed = JSON.parse(data);",
          "  return `${parsed.name} is a ${parsed.role}`;",
          "}"
        ]
      },
      "verify": {
        "execution": {}
      }
    },
    {
      "type": "user_input",
      "data": {
        "text": "Create a file named after them with their info",
        "submit": true
      }
    },
    {
      "type": "llm_response",
      "trigger": {
        "pattern": "named after them",
        "match_type": "contains"
      },
      "response": {
        "typescript": [
          "async function agent_code(): Promise<string> {",
          "  const data = await readFile('user_data.json');",
          "  const parsed = JSON.parse(data);",
          "  const filename = `${parsed.name.toLowerCase()}_profile.txt`;",
          "  const content = `Name: ${parsed.name}\\nRole: ${parsed.role}`;",
          "  await writeFile(filename, content);",
          "  return `Created ${filename} with profile information`;",
          "}"
        ]
      },
      "verify": {
        "files": [
          {
            "path": "alice_profile.txt",
            "exists": true,
            "contains": ["Alice", "developer"]
          }
        ]
      }
    },
    {
      "type": "user_input",
      "data": {
        "text": "What was the first thing I asked you about?",
        "submit": true
      }
    },
    {
      "type": "llm_response",
      "trigger": {
        "pattern": "first thing",
        "match_type": "contains"
      },
      "response": {
        "typescript": [
          "async function agent_code(): Promise<string> {",
          "  return 'The first request was to read user_data.json and tell you the name';",
          "}"
        ]
      },
      "verify": {
        "execution": {}
      }
    }
  ],
  "final_verify": {
    "files": [
      {
        "path": "alice_profile.txt",
        "exists": true,
        "contains": ["Alice", "developer"]
      }
    ]
  }
}
