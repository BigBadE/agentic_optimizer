{
  "name": "WorkUnit Subtask Tracking",
  "description": "Tests WorkUnit creation, subtask tracking, and progress calculation",
  "tags": [
    "conversation",
    "work_unit",
    "subtasks",
    "threads"
  ],
  "setup": {
    "files": {},
    "terminal_size": [
      120,
      40
    ]
  },
  "events": [
    {
      "type": "user_input",
      "data": {
        "text": "Create a multi-step project setup",
        "submit": true
      }
    },
    {
      "type": "llm_response",
      "verify": {
        "files": [
          {
            "path": "work_unit_test.json",
            "exists": true,
            "contains": [
              "task_id",
              "subtasks",
              "progress_percentage"
            ]
          },
          {
            "path": "README.md",
            "exists": true
          },
          {
            "path": "src/main.rs",
            "exists": true
          },
          {
            "path": "tests/test.rs",
            "exists": true
          }
        ],
        "ui": {
          "work_unit": {
            "exists": true,
            "status": "completed",
            "subtask_count": 3,
            "progress_percentage": 100,
            "is_terminal": true,
            "tier_used": "test-mock",
            "subtask_titles": [
              "Create README",
              "Create src",
              "Create tests"
            ]
          }
        }
      },
      "strategy": {
        "type": "sequence",
        "responses": [
          {
            "typescript": [
              "async function agent_code(): Promise<any> {",
              "  const work_unit_test = {",
              "    task_id: '12345678',",
              "    tier_used: 'local',",
              "    subtasks: [",
              "      { description: 'Create README', difficulty: 3, status: 'pending' },",
              "      { description: 'Create src directory', difficulty: 2, status: 'pending' },",
              "      { description: 'Create tests directory', difficulty: 2, status: 'pending' }",
              "    ],",
              "    progress_percentage: 0",
              "  };",
              "  ",
              "  await writeFile('work_unit_test.json', JSON.stringify(work_unit_test, null, 2));",
              "  ",
              "  return {",
              "    title: 'Multi-step project setup',",
              "    steps: [",
              "      { title: 'Create README', description: 'Create README.md file', step_type: 'implementation' },",
              "      { title: 'Create src', description: 'Create src/ directory', step_type: 'implementation' },",
              "      { title: 'Create tests', description: 'Create tests/ directory', step_type: 'implementation' }",
              "    ]",
              "  };",
              "}"
            ]
          },
          {
            "typescript": [
              "async function agent_code(): Promise<string> {",
              "  await writeFile('README.md', '# Project');",
              "  return 'Created README';",
              "}"
            ]
          },
          {
            "typescript": [
              "async function agent_code(): Promise<string> {",
              "  await writeFile('src/main.rs', 'fn main() {}');",
              "  return 'Created src directory';",
              "}"
            ]
          },
          {
            "typescript": [
              "async function agent_code(): Promise<string> {",
              "  await writeFile('tests/test.rs', '#[test] fn test_basic() {}');",
              "  return 'Created tests directory';",
              "}"
            ]
          }
        ]
      }
    }
  ],
  "final_verify": {
    "files": [
      {
        "path": "work_unit_test.json",
        "exists": true,
        "contains": [
          "12345678",
          "Create README",
          "Create src directory",
          "Create tests directory"
        ]
      },
      {
        "path": "README.md",
        "exists": true,
        "contains": [
          "# Project"
        ]
      },
      {
        "path": "src/main.rs",
        "exists": true,
        "contains": [
          "fn main()"
        ]
      },
      {
        "path": "tests/test.rs",
        "exists": true,
        "contains": [
          "#[test]"
        ]
      }
    ],
    "ui": {
      "work_unit": {
        "exists": true,
        "status": "completed",
        "subtask_count": 3,
        "progress_percentage": 100,
        "is_terminal": true,
        "tier_used": "test-mock",
        "subtask_titles": [
          "Create README",
          "Create src",
          "Create tests"
        ]
      }
    }
  }
}
